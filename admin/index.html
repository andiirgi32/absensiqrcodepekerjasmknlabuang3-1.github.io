<tbody>
    <?php
    $no = 1;
    while ($data_pekerja = mysqli_fetch_array($sql_pekerja)) {
      $nip = $data_pekerja['nip'];
      $absen_data = isset($absensi_data[$nip]) ? $absensi_data[$nip] : [
        'tanggal' => '',
        'waktudatang' => '',
        'keterangandatang' => '',
        'fotodatang' => '',
        'waktupulang' => '',
        'keteranganpulang' => '',
        'fotopulang' => '',
        'keterangantakabsen' => '',
        'keterangankhusus' => ''
      ];

      $ket_datang = '';
      if ($absen_data['keterangandatang'] == 'Datang Cepat') {
        $ket_datang = 'p-2 fw-bolder text-center text-bg-warning card';
      } elseif ($absen_data['keterangandatang'] == 'Datang Tepat Waktu') {
        $ket_datang = 'p-2 fw-bolder text-center text-bg-success card';
      } elseif ($absen_data['keterangandatang'] == 'Datang Terlambat') {
        $ket_datang = 'p-2 fw-bolder text-center text-bg-danger card';
      }

      $ket_pulang = '';
      if ($absen_data['keteranganpulang'] == 'Pulang Cepat') {
        $ket_pulang = 'p-2 fw-bolder text-center text-bg-warning card';
      } elseif ($absen_data['keteranganpulang'] == 'Pulang Tepat Waktu') {
        $ket_pulang = 'p-2 fw-bolder text-center text-bg-success card';
      } elseif ($absen_data['keteranganpulang'] == 'Pulang Terlambat') {
        $ket_pulang = 'p-2 fw-bolder text-center text-bg-danger card';
      }

      $ket_tak_absen = '';
      if ($absen_data['keterangantakabsen'] == 'Sakit') {
        $ket_tak_absen = 'p-2 fw-bolder text-center text-bg-warning card';
      } elseif ($absen_data['keterangantakabsen'] == 'Luar Dinas') {
        $ket_tak_absen = 'p-2 fw-bolder text-center text-bg-secondary card';
      } elseif ($absen_data['keterangantakabsen'] == 'Alpa') {
        $ket_tak_absen = 'p-2 fw-bolder text-center text-bg-danger card';
      } elseif ($absen_data['keterangantakabsen'] == 'Izin') {
        $ket_tak_absen = 'p-2 fw-bolder text-center text-bg-primary card';
      }
    ?>
    <tr>
        <td>
            <?php echo $no++; ?>
        </td>
        <td>
            <div style="width: 250px;">
                <?php echo $data_pekerja['nama']; ?><br>
                NIP:
                <?= $data_pekerja['nip'] ?>
            </div>
        </td>
        <td>
            <div style="width: 90px;">
                <?php echo $absen_data['tanggal']; ?>
            </div>
        </td>
        <td>
            <div style="width: 100px;">
                <?php if ($absen_data['waktudatang'] != '00:00:00') : ?>
                <?php echo $absen_data['waktudatang']; ?>
                <?php if (!empty($absen_data['waktupulang'])) {
                                                          echo "WITA";
                                                        } ?>
                <?php else : ?>
                <?php if ($absen_data['keterangantakabsen'] != '') : ?>
                <div class="<?= $ket_tak_absen ?>">
                    <?php echo $absen_data['keterangantakabsen']; ?>
                </div>
                <?php endif; ?>
                <?php endif; ?>
            </div>
        </td>
        <td>
            <div style="width: 180px;" class="<?php echo $ket_datang; ?>">
                <?php if ($absen_data['keterangandatang'] != '') : ?>
                <?php echo $absen_data['keterangandatang']; ?>
                <?php else : ?>
                <?php if ($absen_data['keterangantakabsen'] != '') : ?>
                <div class="<?= $ket_tak_absen ?>">
                    <?php echo $absen_data['keterangantakabsen']; ?>
                </div>
                <?php endif; ?>
                <?php endif; ?>
            </div>
        </td>
        <td>
            <div style="width: 125px;">
                <?php if (!empty($absen_data['fotodatang'])) : ?>
                <a href="fotobuktidatang/<?= $absen_data['fotodatang']; ?>" target="_blank">
                    <img src="fotobuktidatang/<?php echo $absen_data['fotodatang']; ?>" alt="Foto Datang" width="100%">
                </a>
                <?php endif; ?>
            </div>
        </td>
        <td>
            <div style="width: 100px;">
                <?php if ($absen_data['waktupulang'] != '00:00:00') : ?>
                <?php echo $absen_data['waktupulang']; ?>
                <?php if (!empty($absen_data['waktupulang'])) {
                                                          echo "WITA";
                                                        } ?>
                <?php else : ?>
                <?php if ($absen_data['keterangantakabsen'] != '') : ?>
                <div class="<?= $ket_tak_absen ?>">
                    <?php echo $absen_data['keterangantakabsen']; ?>
                </div>
                <?php endif; ?>
                <?php endif; ?>
            </div>
        </td>
        <td>
            <div style="width: 180px;" class="<?php echo $ket_pulang ?>">
                <?php if ($absen_data['keteranganpulang'] != '') : ?>
                <?php echo $absen_data['keteranganpulang']; ?>
                <?php else : ?>
                <?php if ($absen_data['keterangantakabsen'] != '') : ?>
                <div class="<?= $ket_tak_absen ?>">
                    <?php echo $absen_data['keterangantakabsen']; ?>
                </div>
                <?php endif; ?>
                <?php endif; ?>
            </div>
        </td>
        <td>
            <div style="width: 125px;">
                <?php if (!empty($absen_data['fotopulang'])) : ?>
                <a href="fotobuktipulang/<?= $absen_data['fotopulang']; ?>" target="_blank">
                    <img src="fotobuktipulang/<?= $absen_data['fotopulang']; ?>" alt="Foto Pulang" width="100%">
                </a>
                <?php endif; ?>
            </div>
        </td>
        <?php if ($is_saturday) : ?>
        <td>
            <div style="width: 250px;">
                <?php echo $absen_data['keterangankhusus']; ?>
            </div>
        </td>
        <?php endif; ?>
        <?php
        $nip_absen = $data_pekerja['nip'];
        $tanggal_absen = $absen_data['tanggal'];
        $get_sql_cek_absen = mysqli_query($conn, "SELECT * FROM absen WHERE nip='$nip_absen' AND tanggal='$tanggal_absen'");
        $get_data_cek_absen = mysqli_num_rows($get_sql_cek_absen) > 0;
        ?>
        <td>
            <?php if ($get_data_cek_absen) : ?>
            <a href="" class="btn btn-primary" data-bs-toggle="modal"
                data-bs-target="#editAbsen<?= $absen_data['id'] ?>"><i class="bi bi-pencil-square"></i> Edit</a>
            <?php else : ?>
            <?php endif; ?>
        </td>
    </tr>
    <?php
    }
    ?>
</tbody>